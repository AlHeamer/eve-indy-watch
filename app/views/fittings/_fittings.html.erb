<%= turbo_frame_tag 'fittings' do %>
  <%= render(CardComponent.new(body_class_names: '')) do |c| %>
    <% c.header do %>
      <%= render(PaginatorComponent.new(pagy: paginator)) %>
    <% end %>

    <% c.body do %>
      <%= render(TableComponent.new) do |t| %>
        <% t.header width: '1/3' do %>Fitting<% end %>
        <% t.header width: '1/6' do %>Contracts<% end %>
        <% t.header width: '1/6' do %>Quality Contracts<% end %>
        <% t.header width: '1/6' do %><%= current_alliance.main_market_name %> Market<% end %>
        <% t.header width: '1/6' do %><%= current_alliance.appraisal_market_name %> Market<% end %>

        <% fittings.each do |fitting| %>
          <% t.row do |tr| %>
            <% tr.cell do %>
              <div class="flex items-center">
                <div class="flex-shrink-0 h-8 w-8">
                  <%= image_tag fitting.type.icon_url, class: 'h-8 w-8 rounded-md' %>
                </div>
                <div class="ml-4">
                  <div class="text-xs font-medium text-gray-900">
                    <%= link_to fitting.name, fitting_path(fitting), class: 'text-xs hover:text-indigo-900' %>
                  </div>
                  <div class="text-xs text-gray-500">
                    <%= fitting.type.name %>
                  </div>
                </div>
              </div>
            <% end %>
            <% tr.cell do %>
              <%= fitting.contracts_all_on_hand&.count || 'N/A' %>
            <% end %>
            <% tr.cell do %>
              <%= fitting.contract_quality ? number_to_percentage(fitting.contract_quality, precision: 0) : 'N/A' %>
            <% end %>
            <% tr.cell do %>
              <% if fitting.main_market %>
                <%= fitting.market_on_hand(fitting.main_market) || 'N/A' %>
              <% end %>
            <% end %>
            <% tr.cell do %>
              <% if fitting.appraisal_market %>
                <%= fitting.market_on_hand(fitting.appraisal_market) || 'N/A' %>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>

    <% c.footer do %>
      <%= render(PaginatorComponent.new(pagy: paginator)) %>
    <% end %>
  <% end %>
<% end %>
