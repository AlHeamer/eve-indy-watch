<%= turbo_frame_tag 'market_statistics' do %>
  <%= render(CardComponent.new(title: 'Market Availability', body_class_names: '')) do |c| %>
    <% c.description do %><p class="text-gray-900 text-xs font-italic">Data refreshed every 5 minutes.<% end %>
    <% c.body do %>
      <%= render(TableComponent.new) do |t| %>
        <% t.header width: '3/12' do %>Market<% end %>
        <% t.header width: '3/12' do %>On Hand<% end %>
        <% t.header width: '3/12' do %>Price (Buy)<% end %>
        <% t.header width: '2/12' do %>Price (Sell)<% end %>
        <% t.header width: '2/12' do %>Price (Split)<% end %>
        <% t.header width: '2/12' do %>Limiting Items<% end %>

        <% render 'market_availability_market', fitting: fitting, market: fitting.main_market, t: t if fitting.main_market %>
        <% render 'market_availability_market', fitting: fitting, market: fitting.appraisal_market, t: t if fitting.appraisal_market %>

        <% fitting.markets.where.not(id: [fitting.main_market.id, fitting.appraisal_market.id]).order(:name).each do |market| %>
          <% render 'market_availability_market', fitting: fitting, market: market, t: t if fitting.market %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
<% end %>
